<!DOCTYPE html>
<html>
<head>
    <title>File Transfer App</title>
    <link rel="manifest" href="/static/manifest.json">
<meta name="theme-color" content="#0f172a">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        img.preview {
            max-width: 200px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        body {
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: white;
    font-family: "Segoe UI", sans-serif;
}

.card {
    background: rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(12px);
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(255,255,255,0.2);
}

.file-card {
    background: rgba(255,255,255,0.15);
    border-radius: 12px;
    padding: 10px;
    text-align: center;
}

.file-card img {
    max-width: 100%;
    border-radius: 8px;
}

    </style>
</head>
<body class="p-4">

<h1>File Transfer App</h1>

{% if message %}
<div class="alert alert-success">{{ message }}</div>
{% endif %}

<form method="POST" enctype="multipart/form-data" class="mb-4">
<input type="file" name="file" multiple class="form-control mb-2" required>
    <button class="btn btn-primary">Upload</button>
</form>

<hr>

<h4>Scan QR Code on Mobile</h4>
<img src="{{ url_for('static', filename=qr_image) }}" width="200">

<hr>

<h4>Received Files</h4>

{% if files|length > 1 %}
<button class="btn btn-warning mb-3" onclick="downloadAllFiles()">
    Download All
</button>
{% endif %}


<div class="row">
{% for file in files %}
    <div class="col-md-3 mb-4">
        {% if file.endswith(('png','jpg','jpeg','gif','webp')) %}
        <img src="{{ url_for('download_file', filename=file) }}" class="preview">
        {% endif %}
        <p>{{ file }}</p>
        <a href="{{ url_for('download_file', filename=file) }}" class="btn btn-sm btn-outline-primary">
            Download
        </a>
    </div>
{% else %}
    <p>No files uploaded yet.</p>
{% endfor %}
</div>


<div class="card">
    <!-- upload form, qr, files here -->
</div>




<script>

    if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/static/service-worker.js");
}


window.addEventListener("beforeunload", function () {
    navigator.sendBeacon("/clear-session");
});



function downloadAllFiles() {
    const files = {{ files | tojson }};

    files.forEach((file, index) => {
        setTimeout(() => {
            const link = document.createElement("a");
            link.href = `/uploads/${file}`;
            link.download = file;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }, index * 400); // delay prevents browser blocking
    });
}


</script>


</body>
</html>
